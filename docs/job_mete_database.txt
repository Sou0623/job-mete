# ğŸ—„ï¸ Job Mete ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆæ›¸ v1.5

---

## 1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¦‚è¦

### 1.1 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é¸å®šç†ç”±

**æ¡ç”¨:** Firebase Firestore (NoSQL ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæŒ‡å‘ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹)

**é¸å®šç†ç”±:**
- âœ… ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸæ©Ÿèƒ½ï¼ˆonSnapshotï¼‰
- âœ… ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£ï¼ˆã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ï¼‰
- âœ… Firebase Authentication / Functionsã¨ã®ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ãªçµ±åˆ
- âœ… æŸ”è»Ÿãªã‚¹ã‚­ãƒ¼ãƒï¼ˆJSONå½¢å¼ï¼‰
- âœ… è¤‡é›‘ãªJOINä¸è¦ï¼ˆéæ­£è¦åŒ–ã§å¯¾å¿œï¼‰

**åˆ¶ç´„äº‹é …:**
- âŒ è¤‡é›‘ãªã‚¯ã‚¨ãƒªã¯å›°é›£ï¼ˆé›†è¨ˆãªã©ï¼‰
- âŒ ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã¯é™å®šçš„
- âŒ ãƒ•ãƒ«ãƒ†ã‚­ã‚¹ãƒˆæ¤œç´¢ã¯æ¨™æº–æ©Ÿèƒ½ãªã—

---

## 2. ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«å…¨ä½“åƒ

### 2.1 ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³æ§‹é€ å›³

```
Firestore Root
â”‚
â””â”€â”€ users (collection)
    â””â”€â”€ {userId} (document)
        â”œâ”€â”€ profile (document)                 # ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«
        â”‚
        â”œâ”€â”€ companies (subcollection)          # ä¼æ¥­ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿
        â”‚   â””â”€â”€ {companyId} (document)
        â”‚
        â”œâ”€â”€ events (subcollection)             # äºˆå®šãƒ‡ãƒ¼ã‚¿
        â”‚   â””â”€â”€ {eventId} (document)
        â”‚
        â”œâ”€â”€ trends (subcollection)             # å‚¾å‘åˆ†æçµæœ
        â”‚   â””â”€â”€ {trendId} (document)
        â”‚       â””â”€â”€ latest (å›ºå®šID)
        â”‚
        â”œâ”€â”€ usage (subcollection)              # APIä½¿ç”¨é‡ç®¡ç†
        â”‚   â””â”€â”€ {usageId} (document)
        â”‚       â””â”€â”€ today (å›ºå®šID)
        â”‚
        â””â”€â”€ tokens (subcollection)             # OAuth ãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆå°†æ¥ï¼‰
            â””â”€â”€ calendar (document)
```

### 2.2 ERå›³ï¼ˆæ¦‚å¿µãƒ¢ãƒ‡ãƒ«ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Users     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1:N
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                               â”‚
       â–¼                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Companies   â”‚                â”‚    Events    â”‚
â”‚              â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚              â”‚
â”‚  (ä¼æ¥­ãƒ‡ãƒ¼ã‚¿) â”‚      N:1       â”‚  (äºˆå®šãƒ‡ãƒ¼ã‚¿) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   companyId    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                               
       â”‚ 1:N                           
       â–¼                               
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                
â”‚   Trends     â”‚                
â”‚ (å‚¾å‘åˆ†æ)    â”‚                
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                

é–¢ä¿‚æ€§:
- User : Companies = 1 : N
- User : Events = 1 : N
- Companies : Events = 1 : N
- User : Trends = 1 : 1 (latest)
```

---

## 3. ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³è©³ç´°è¨­è¨ˆ

### 3.1 users/{userId}/profile

**ç”¨é€”:** ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®åŸºæœ¬æƒ…å ±ã‚’ä¿å­˜

#### ã‚¹ã‚­ãƒ¼ãƒå®šç¾©

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å | å‹ | å¿…é ˆ | èª¬æ˜ | ä¾‹ |
|------------|---|------|------|---|
| uid | string | âœ… | Firebase Auth UID | "abc123xyz..." |
| email | string | âœ… | ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ | "user@example.com" |
| displayName | string | âœ… | è¡¨ç¤ºå | "å±±ç”°å¤ªéƒ" |
| photoURL | string |  | ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒURL | "https://..." |
| createdAt | timestamp | âœ… | ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆæ—¥æ™‚ | "2025-10-07T10:00:00Z" |
| lastLoginAt | timestamp | âœ… | æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³æ—¥æ™‚ | "2025-10-12T14:30:00Z" |

#### ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿

```json
{
  "uid": "abc123xyz789",
  "email": "yamada@example.com",
  "displayName": "å±±ç”°å¤ªéƒ",
  "photoURL": "https://lh3.googleusercontent.com/...",
  "createdAt": "2025-10-07T10:00:00Z",
  "lastLoginAt": "2025-10-12T14:30:00Z"
}
```

---

### 3.2 users/{userId}/companies/{companyId}

**ç”¨é€”:** ä¼æ¥­ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ï¼ˆåˆ†æçµæœã€ãƒ¡ãƒ¢ã€çµ±è¨ˆã‚’å«ã‚€ï¼‰

#### ã‚¹ã‚­ãƒ¼ãƒå®šç¾©

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å | å‹ | å¿…é ˆ | èª¬æ˜ | ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ |
|------------|---|------|------|------------|
| companyName | string | âœ… | ä¼æ¥­åï¼ˆè¡¨ç¤ºç”¨ï¼‰ | - |
| normalizedName | string | âœ… | æ­£è¦åŒ–ã•ã‚ŒãŸä¼æ¥­å | âœ… ASC |
| companyNameVariations | array |  | æ¤œå‡ºã•ã‚ŒãŸè¡¨è¨˜ã‚†ã‚Œ | - |
| analysis | map | âœ… | ä¼æ¥­åˆ†æçµæœ | - |
| analysisMetadata | map | âœ… | åˆ†æãƒ¡ã‚¿æƒ…å ± | - |
| userNotes | string |  | ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒ¢ | - |
| stats | map | âœ… | çµ±è¨ˆæƒ…å ± | - |
| createdAt | timestamp | âœ… | ä½œæˆæ—¥æ™‚ | âœ… DESC |
| updatedAt | timestamp | âœ… | æ›´æ–°æ—¥æ™‚ | - |

#### ã‚µãƒ–ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è©³ç´°

**analysisï¼ˆä¼æ¥­åˆ†æçµæœï¼‰**
```typescript
{
  businessOverview: string;        // äº‹æ¥­å†…å®¹ï¼ˆ100æ–‡å­—ï¼‰
  strengths: string[];             // å¼·ã¿ï¼ˆ3é …ç›®ï¼‰
  recentNews: string;              // æœ€è¿‘ã®å‹•å‘ï¼ˆ150æ–‡å­—ï¼‰
  industryPosition: string;        // æ¥­ç•Œãƒã‚¸ã‚·ãƒ§ãƒ³ï¼ˆ100æ–‡å­—ï¼‰
  recruitmentInsights: string;     // æ¡ç”¨æƒ…å ±ï¼ˆ80æ–‡å­—ï¼‰
}
```

**analysisMetadataï¼ˆåˆ†æãƒ¡ã‚¿æƒ…å ±ï¼‰**
```typescript
{
  status: 'completed' | 'pending' | 'failed';
  modelUsed: string;               // ä¾‹: "gemini-2.0-flash-exp"
  tokensUsed: number;              // APIä½¿ç”¨ãƒˆãƒ¼ã‚¯ãƒ³æ•°
  searchSources: string[];         // å‚ç…§å…ƒURL
  analyzedAt: string;              // ISO 8601å½¢å¼
  version: string;                 // ã‚¹ã‚­ãƒ¼ãƒãƒãƒ¼ã‚¸ãƒ§ãƒ³
  needsUpdate: boolean;            // å†åˆ†ææ¨å¥¨ãƒ•ãƒ©ã‚°
  lastUpdateCheck: string;         // æœ€çµ‚ãƒã‚§ãƒƒã‚¯æ—¥æ™‚
}
```

**statsï¼ˆçµ±è¨ˆæƒ…å ±ï¼‰**
```typescript
{
  eventCount: number;              // é–¢é€£äºˆå®šæ•°
  firstRegistered: string;         // åˆå›ç™»éŒ²æ—¥æ™‚
  lastEventDate: string | null;    // æœ€æ–°äºˆå®šæ—¥æ™‚
}
```

#### ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿

```json
{
  "companyName": "æ ªå¼ä¼šç¤¾ã‚³ãƒ‰ãƒ¢ãƒ³",
  "normalizedName": "ã“ã©ã‚‚ã‚“",
  "companyNameVariations": [
    "æ ªå¼ä¼šç¤¾ã‚³ãƒ‰ãƒ¢ãƒ³",
    "ã‚³ãƒ‰ãƒ¢ãƒ³",
    "CODMON"
  ],
  "analysis": {
    "businessOverview": "ä¿è‚²åœ’ãƒ»å¹¼ç¨šåœ’å‘ã‘ICTã‚·ã‚¹ãƒ†ãƒ ã‚’é–‹ç™ºãƒ»æä¾›ã™ã‚‹SaaSä¼æ¥­ã€‚ä¿è‚²ç¾å ´ã®DXã‚’æ¨é€²ã€‚",
    "strengths": [
      "ä¿è‚²æ¥­ç•Œã‚·ã‚§ã‚¢No.1ã®ICTãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ",
      "14,000ä»¥ä¸Šã®ä¿è‚²æ–½è¨­ã§åˆ©ç”¨ã•ã‚Œã‚‹ä¿¡é ¼æ€§",
      "ä¿è‚²DXåˆ†é‡ã®ãƒ‘ã‚¤ã‚ªãƒ‹ã‚¢ã¨ã—ã¦ã®å®Ÿç¸¾"
    ],
    "recentNews": "2024å¹´9æœˆã€ä¿è‚²å£«å‘ã‘AIç›¸è«‡æ©Ÿèƒ½ã‚’ãƒªãƒªãƒ¼ã‚¹ã€‚è‡ªæ²»ä½“ã¨ã®é€£æºã‚’å¼·åŒ–ã—ã€ãƒ‡ã‚¸ã‚¿ãƒ«åŒ–æ”¯æ´äº‹æ¥­ã‚’æ‹¡å¤§ä¸­ã€‚",
    "industryPosition": "ä¿è‚²ãƒ†ãƒƒã‚¯æ¥­ç•Œã®ãƒªãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚«ãƒ³ãƒ‘ãƒ‹ãƒ¼ã€‚ç«¶åˆã«ã¯ãƒ¦ãƒ‹ãƒ•ã‚¡ã€ã‚­ãƒƒã‚ºãƒªãƒ¼ãªã©ã€‚",
    "recruitmentInsights": "ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒ»ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã‚’ç©æ¥µæ¡ç”¨ã€‚ç¤¾ä¼šè²¢çŒ®æ€§ã®é«˜ã„äº‹æ¥­ã«èˆˆå‘³ãŒã‚ã‚‹å­¦ç”Ÿå‘ã‘ã€‚"
  },
  "analysisMetadata": {
    "status": "completed",
    "modelUsed": "gemini-2.0-flash-exp",
    "tokensUsed": 1234,
    "searchSources": [
      "https://company.codmon.co.jp/news/...",
      "https://prtimes.jp/..."
    ],
    "analyzedAt": "2025-10-12T15:30:00Z",
    "version": "1.0",
    "needsUpdate": false,
    "lastUpdateCheck": "2025-10-12T15:30:00Z"
  },
  "userNotes": "ä¿è‚²Ã—ãƒ†ãƒƒã‚¯ã§ç¤¾ä¼šè²¢çŒ®ã§ãã‚‹ç‚¹ã«é­…åŠ›ã€‚SaaSäº‹æ¥­ã®ã‚¹ã‚±ãƒ¼ãƒ«æ„Ÿã‚‚å­¦ã³ãŸã„ã€‚",
  "stats": {
    "eventCount": 3,
    "firstRegistered": "2025-10-07T10:00:00Z",
    "lastEventDate": "2025-10-20T14:00:00Z"
  },
  "createdAt": "2025-10-07T10:00:00Z",
  "updatedAt": "2025-10-12T15:30:00Z"
}
```

#### ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¨­è¨ˆ

```javascript
// è‡ªå‹•ä½œæˆã•ã‚Œã‚‹ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
companies.normalizedName (ASC)
companies.createdAt (DESC)

// æ‰‹å‹•ä½œæˆãŒå¿…è¦ãªè¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
companies.stats.eventCount (DESC) + companies.createdAt (DESC)
```

---

### 3.3 users/{userId}/events/{eventId}

**ç”¨é€”:** é¢æ¥ãƒ»èª¬æ˜ä¼šãªã©ã®äºˆå®šãƒ‡ãƒ¼ã‚¿

#### ã‚¹ã‚­ãƒ¼ãƒå®šç¾©

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å | å‹ | å¿…é ˆ | èª¬æ˜ | ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ |
|------------|---|------|------|------------|
| companyId | string | âœ… | ä¼æ¥­IDï¼ˆå‚ç…§ï¼‰ | âœ… ASC |
| companyName | string | âœ… | ä¼æ¥­åï¼ˆéæ­£è¦åŒ–ï¼‰ | - |
| eventType | string | âœ… | ã‚¤ãƒ™ãƒ³ãƒˆç¨®åˆ¥ | - |
| date | timestamp | âœ… | é–‹å§‹æ—¥æ™‚ | âœ… ASC |
| endDate | timestamp | âœ… | çµ‚äº†æ—¥æ™‚ | - |
| location | string |  | å ´æ‰€ | - |
| memo | string |  | ãƒ¡ãƒ¢ | - |
| googleCalendar | map |  | Calendaré€£æºæƒ…å ± | - |
| status | string | âœ… | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | âœ… ASC |
| result | string |  | çµæœ | - |
| resultMemo | string |  | çµæœãƒ¡ãƒ¢ | - |
| createdAt | timestamp | âœ… | ä½œæˆæ—¥æ™‚ | - |
| updatedAt | timestamp | âœ… | æ›´æ–°æ—¥æ™‚ | - |

#### Enumå®šç¾©

**eventTypeï¼ˆã‚¤ãƒ™ãƒ³ãƒˆç¨®åˆ¥ï¼‰**
- `ä¸€æ¬¡é¢æ¥`
- `äºŒæ¬¡é¢æ¥`
- `æœ€çµ‚é¢æ¥`
- `èª¬æ˜ä¼š`
- `ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³`
- `ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«é¢è«‡`
- `ãã®ä»–`

**statusï¼ˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼‰**
- `scheduled`: äºˆå®š
- `completed`: å®Œäº†
- `cancelled`: ã‚­ãƒ£ãƒ³ã‚»ãƒ«

**resultï¼ˆçµæœï¼‰**
- `passed`: é€šé
- `failed`: ä¸åˆæ ¼
- `waiting`: çµæœå¾…ã¡
- `null`: æœªè¨˜éŒ²

#### ã‚µãƒ–ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è©³ç´°

**googleCalendarï¼ˆCalendaré€£æºæƒ…å ±ï¼‰**
```typescript
{
  eventId: string | null;          // Googleã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®EventID
  syncStatus: 'synced' | 'pending' | 'failed';
  lastSyncAttempt: string | null;  // æœ€çµ‚åŒæœŸè©¦è¡Œæ—¥æ™‚
}
```

#### ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿

```json
{
  "companyId": "company_abc123",
  "companyName": "æ ªå¼ä¼šç¤¾ã‚³ãƒ‰ãƒ¢ãƒ³",
  "eventType": "ä¸€æ¬¡é¢æ¥",
  "date": "2025-10-15T13:00:00+09:00",
  "endDate": "2025-10-15T14:00:00+09:00",
  "location": "ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ï¼ˆZoomï¼‰",
  "memo": "æ‹…å½“ï¼šä½è—¤æ§˜ã€‚TypeScriptçµŒé¨“ã‚’ã‚¢ãƒ”ãƒ¼ãƒ«",
  "googleCalendar": {
    "eventId": "abc123xyz789",
    "syncStatus": "synced",
    "lastSyncAttempt": "2025-10-12T10:05:00Z"
  },
  "status": "scheduled",
  "result": null,
  "resultMemo": "",
  "createdAt": "2025-10-07T10:00:00Z",
  "updatedAt": "2025-10-12T14:20:00Z"
}
```

#### ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¨­è¨ˆ

```javascript
// å˜ä¸€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
events.companyId (ASC)
events.date (ASC)
events.status (ASC)

// è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
events.companyId (ASC) + events.date (ASC)
events.status (ASC) + events.date (ASC)
events.date (ASC) + events.status (ASC)
```

---

### 3.4 users/{userId}/trends/latest

**ç”¨é€”:** å‚¾å‘åˆ†æçµæœï¼ˆæœ€æ–°ã®ã¿ä¿å­˜ï¼‰

#### ã‚¹ã‚­ãƒ¼ãƒå®šç¾©

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å | å‹ | å¿…é ˆ | èª¬æ˜ |
|------------|---|------|------|
| summary | map | âœ… | åˆ†æã‚µãƒãƒªãƒ¼ |
| sourceCompanies | array | âœ… | åˆ†æå¯¾è±¡ä¼æ¥­ |
| analyzedAt | timestamp | âœ… | åˆ†ææ—¥æ™‚ |
| companyCount | number | âœ… | åˆ†æå¯¾è±¡ä¼æ¥­æ•° |
| modelUsed | string | âœ… | ä½¿ç”¨ãƒ¢ãƒ‡ãƒ« |

#### ã‚µãƒ–ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è©³ç´°

**summaryï¼ˆåˆ†æã‚µãƒãƒªãƒ¼ï¼‰**
```typescript
{
  overallTrend: string;            // å…¨ä½“å‚¾å‘ï¼ˆ200æ–‡å­—ï¼‰
  topIndustries: Array<{           // æ¥­ç•Œåˆ¥é›†è¨ˆ
    name: string;
    count: number;
    percentage: number;
  }>;
  commonKeywords: Array<{          // å…±é€šã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰
    word: string;
    count: number;
  }>;
  recommendedSkills: string[];     // æ¨å¥¨ã‚¹ã‚­ãƒ«
}
```

**sourceCompaniesï¼ˆåˆ†æå¯¾è±¡ä¼æ¥­ï¼‰**
```typescript
Array<{
  companyId: string;
  companyName: string;
}>
```

#### ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿

```json
{
  "summary": {
    "overallTrend": "SaaSãƒ»EdTechãƒ»HRTechãªã©ã€ã€Œç¤¾ä¼šèª²é¡ŒÃ—ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ã€é ˜åŸŸã®ä¼æ¥­ã«å¼·ã„é–¢å¿ƒã€‚ç‰¹ã«BtoB SaaSã®ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆé–‹ç™ºã«èˆˆå‘³ã€‚",
    "topIndustries": [
      {
        "name": "SaaS/Enterprise Tech",
        "count": 5,
        "percentage": 50
      },
      {
        "name": "EdTech/ä¿è‚²Tech",
        "count": 3,
        "percentage": 30
      },
      {
        "name": "HRTech",
        "count": 2,
        "percentage": 20
      }
    ],
    "commonKeywords": [
      { "word": "SaaS", "count": 7 },
      { "word": "ç¤¾ä¼šè²¢çŒ®", "count": 5 },
      { "word": "TypeScript", "count": 4 },
      { "word": "ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆé–‹ç™º", "count": 4 },
      { "word": "ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—", "count": 3 }
    ],
    "recommendedSkills": [
      "TypeScript/Reactç­‰ã®ãƒ¢ãƒ€ãƒ³ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰æŠ€è¡“",
      "BtoB SaaSã®ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆçŸ¥è­˜",
      "ç¤¾ä¼šèª²é¡Œã¸ã®å•é¡Œæ„è­˜"
    ]
  },
  "sourceCompanies": [
    {
      "companyId": "company_abc123",
      "companyName": "æ ªå¼ä¼šç¤¾ã‚³ãƒ‰ãƒ¢ãƒ³"
    },
    {
      "companyId": "company_def456",
      "companyName": "æ ªå¼ä¼šç¤¾SmartHR"
    }
  ],
  "analyzedAt": "2025-10-12T16:00:00Z",
  "companyCount": 8,
  "modelUsed": "gemini-2.0-flash-exp"
}
```

---

### 3.5 users/{userId}/usage/today

**ç”¨é€”:** APIä½¿ç”¨é‡ç®¡ç†ï¼ˆæ—¥æ¬¡ãƒªã‚»ãƒƒãƒˆï¼‰

#### ã‚¹ã‚­ãƒ¼ãƒå®šç¾©

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å | å‹ | å¿…é ˆ | èª¬æ˜ |
|------------|---|------|------|
| date | string | âœ… | å¯¾è±¡æ—¥ï¼ˆYYYY-MM-DDï¼‰ |
| counts | map | âœ… | å„ç¨®ã‚«ã‚¦ãƒ³ãƒˆ |
| resetAt | timestamp | âœ… | ãƒªã‚»ãƒƒãƒˆäºˆå®šæ—¥æ™‚ |

#### ã‚µãƒ–ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è©³ç´°

**countsï¼ˆå„ç¨®ã‚«ã‚¦ãƒ³ãƒˆï¼‰**
```typescript
{
  companyAnalysis: number;         // ä¼æ¥­åˆ†æå®Ÿè¡Œå›æ•°
  trendAnalysis: number;           // å‚¾å‘åˆ†æå®Ÿè¡Œå›æ•°
  reAnalysis: number;              // å†åˆ†æå®Ÿè¡Œå›æ•°
}
```

#### ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿

```json
{
  "date": "2025-10-12",
  "counts": {
    "companyAnalysis": 4,
    "trendAnalysis": 2,
    "reAnalysis": 1
  },
  "resetAt": "2025-10-13T00:00:00+09:00"
}
```

---

### 3.6 users/{userId}/tokens/calendarï¼ˆå°†æ¥å®Ÿè£…ï¼‰

**ç”¨é€”:** OAuth 2.0ãƒˆãƒ¼ã‚¯ãƒ³ä¿ç®¡

#### ã‚¹ã‚­ãƒ¼ãƒå®šç¾©

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å | å‹ | å¿…é ˆ | èª¬æ˜ |
|------------|---|------|------|
| refreshToken | string | âœ… | ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆæš—å·åŒ–ï¼‰ |
| accessToken | string |  | ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆä¸€æ™‚çš„ï¼‰ |
| expiresAt | timestamp |  | ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³æœ‰åŠ¹æœŸé™ |
| scope | string | âœ… | è¨±å¯ã‚¹ã‚³ãƒ¼ãƒ— |
| createdAt | timestamp | âœ… | ä½œæˆæ—¥æ™‚ |
| updatedAt | timestamp | âœ… | æ›´æ–°æ—¥æ™‚ |

#### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

âš ï¸ **é‡è¦:** ãƒˆãƒ¼ã‚¯ãƒ³ã¯æš—å·åŒ–ã—ã¦ä¿å­˜ã™ã‚‹ã“ã¨
- æœ¬ç•ªç’°å¢ƒã§ã¯å¿…ãšSecret Managerã‚’ä½¿ç”¨
- Firestoreã«å¹³æ–‡ã§ä¿å­˜ã—ãªã„
- ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã¯çŸ­æ™‚é–“ã§å¤±åŠ¹ã•ã›ã‚‹

---

## 4. ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ã¨ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³

### 4.1 æ•´åˆæ€§åˆ¶ç´„

| åˆ¶ç´„ | å®Ÿè£…æ–¹æ³• |
|-----|---------|
| companyIdå‚ç…§æ•´åˆæ€§ | ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã§æ¤œè¨¼ |
| normalizedNameä¸€æ„æ€§ | ã‚¯ã‚¨ãƒªã§é‡è¤‡ãƒã‚§ãƒƒã‚¯ |
| eventCountæ­£ç¢ºæ€§ | Functionsã§ã‚¢ãƒˆãƒŸãƒƒã‚¯ã«æ›´æ–° |
| æ—¥æ¬¡ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ãƒªã‚»ãƒƒãƒˆ | å®Ÿè¡Œæ™‚ã«æ—¥ä»˜ãƒã‚§ãƒƒã‚¯ |

### 4.2 ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³è¨­è¨ˆ

**ã‚·ãƒŠãƒªã‚ª1: äºˆå®šå‰Šé™¤æ™‚ã®ä¼æ¥­çµ±è¨ˆæ›´æ–°**

```typescript
const db = admin.firestore();

await db.runTransaction(async (transaction) => {
  // 1. äºˆå®šå‰Šé™¤
  transaction.delete(eventRef);
  
  // 2. ä¼æ¥­çµ±è¨ˆæ›´æ–°
  const companyRef = db.doc(`users/${userId}/companies/${companyId}`);
  const companyDoc = await transaction.get(companyRef);
  
  const newEventCount = companyDoc.data().stats.eventCount - 1;
  
  if (newEventCount === 0) {
    // äºˆå®šãŒ0ä»¶ãªã‚‰ä¼æ¥­ã‚‚å‰Šé™¤
    transaction.delete(companyRef);
  } else {
    transaction.update(companyRef, {
      'stats.eventCount': newEventCount
    });
  }
});
```

**ã‚·ãƒŠãƒªã‚ª2: ä¼æ¥­å‰Šé™¤æ™‚ã®é–¢é€£äºˆå®šä¸€æ‹¬å‰Šé™¤**

```typescript
// Batch Writeï¼ˆæœ€å¤§500ä»¶ï¼‰
const batch = db.batch();

// ä¼æ¥­å‰Šé™¤
batch.delete(companyRef);

// é–¢é€£äºˆå®šå‰Šé™¤
const events = await db
  .collection(`users/${userId}/events`)
  .where('companyId', '==', companyId)
  .get();

events.forEach(doc => {
  batch.delete(doc.ref);
});

await batch.commit();
```

---

## 5. ã‚¯ã‚¨ãƒªè¨­è¨ˆ

### 5.1 ä¸»è¦ã‚¯ã‚¨ãƒªä¸€è¦§

#### Q1: ä¼æ¥­ä¸€è¦§å–å¾—ï¼ˆç™»éŒ²æ—¥é †ï¼‰

```typescript
db.collection(`users/${userId}/companies`)
  .orderBy('createdAt', 'desc')
  .limit(50)
  .get();
```

**ä½¿ç”¨ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹:** `createdAt (DESC)`

---

#### Q2: ä¼æ¥­åé‡è¤‡ãƒã‚§ãƒƒã‚¯

```typescript
db.collection(`users/${userId}/companies`)
  .where('normalizedName', '==', normalizedName)
  .limit(1)
  .get();
```

**ä½¿ç”¨ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹:** `normalizedName (ASC)`

---

#### Q3: äºˆå®šä¸€è¦§å–å¾—ï¼ˆæ—¥ä»˜é †ï¼‰

```typescript
db.collection(`users/${userId}/events`)
  .where('status', '==', 'scheduled')
  .orderBy('date', 'asc')
  .get();
```

**ä½¿ç”¨ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹:** `status (ASC) + date (ASC)`

---

#### Q4: ä¼æ¥­åˆ¥äºˆå®šå–å¾—

```typescript
db.collection(`users/${userId}/events`)
  .where('companyId', '==', companyId)
  .orderBy('date', 'asc')
  .get();
```

**ä½¿ç”¨ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹:** `companyId (ASC) + date (ASC)`

---

#### Q5: åˆ†æå®Œäº†æ¸ˆã¿ä¼æ¥­å–å¾—ï¼ˆå‚¾å‘åˆ†æç”¨ï¼‰

```typescript
db.collection(`users/${userId}/companies`)
  .where('analysisMetadata.status', '==', 'completed')
  .get();
```

**ä½¿ç”¨ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹:** `analysisMetadata.status (ASC)`

---

### 5.2 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

| æœ€é©åŒ–æ‰‹æ³• | å®Ÿè£…ç®‡æ‰€ | åŠ¹æœ |
|----------|---------|------|
| è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ | é »å‡ºã‚¯ã‚¨ãƒª | 100å€é«˜é€ŸåŒ– |
| limit()ä½¿ç”¨ | ä¸€è¦§å–å¾— | ä¸è¦ãƒ‡ãƒ¼ã‚¿å‰Šæ¸› |
| éæ­£è¦åŒ– | companyName | JOINä¸è¦ |
| ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ | 50ä»¶ä»¥ä¸Šã®ä¸€è¦§ | åˆæœŸãƒ­ãƒ¼ãƒ‰é«˜é€ŸåŒ– |

---

## 6. ãƒ‡ãƒ¼ã‚¿ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ç®¡ç†

### 6.1 ãƒ‡ãƒ¼ã‚¿ä¿æŒæœŸé–“

| ãƒ‡ãƒ¼ã‚¿ç¨®åˆ¥ | ä¿æŒæœŸé–“ | å‰Šé™¤ãƒˆãƒªã‚¬ãƒ¼ |
|----------|---------|------------|
| ä¼æ¥­ãƒ‡ãƒ¼ã‚¿ | äºˆå®šãŒå­˜åœ¨ã™ã‚‹é™ã‚Š | å…¨äºˆå®šå‰Šé™¤æ™‚ |
| äºˆå®šãƒ‡ãƒ¼ã‚¿ | ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå‰Šé™¤ã™ã‚‹ã¾ã§ | æ‰‹å‹•å‰Šé™¤ |
| å‚¾å‘åˆ†æ | æœ€æ–°1ä»¶ã®ã¿ | æ–°è¦åˆ†æå®Ÿè¡Œæ™‚ |
| ä½¿ç”¨é‡ãƒ‡ãƒ¼ã‚¿ | å½“æ—¥ã®ã¿ | æ—¥æ¬¡è‡ªå‹•ãƒªã‚»ãƒƒãƒˆ |
| ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ« | ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå‰Šé™¤ã¾ã§ | ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå‰Šé™¤æ™‚ |

### 6.2 ãƒ‡ãƒ¼ã‚¿å‰Šé™¤ãƒ•ãƒ­ãƒ¼

```
[ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå‰Šé™¤]
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. companieså‰Šé™¤    â”‚
â”‚ 2. eventså‰Šé™¤       â”‚
â”‚ 3. trendså‰Šé™¤       â”‚
â”‚ 4. usageå‰Šé™¤        â”‚
â”‚ 5. tokenså‰Šé™¤       â”‚
â”‚ 6. profileå‰Šé™¤      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
 [Firebase Authå‰Šé™¤]
```

---

## 7. ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¨ãƒªã‚¹ãƒˆã‚¢

### 7.1 ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æˆ¦ç•¥ï¼ˆæœ¬ç•ªç’°å¢ƒï¼‰

| æ–¹æ³• | é »åº¦ | ä¿å­˜æœŸé–“ |
|-----|------|---------|
| è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ— | æ—¥æ¬¡ | 30æ—¥ |
| æ‰‹å‹•ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ | é€±æ¬¡ | 90æ—¥ |

### 7.2 ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒãƒ³ãƒ‰

```bash
# å…¨ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
gcloud firestore export gs://job-mete-backup/$(date +%Y%m%d)

# ç‰¹å®šã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®ã¿
gcloud firestore export gs://job-mete-backup/$(date +%Y%m%d) \
  --collection-ids=users
```

---

## 8. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«

### 8.1 Firestoreã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«å…¨ä½“

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«
    match /users/{userId}/profile {
      allow read, write: if request.auth != null 
                         && request.auth.uid == userId;
    }
    
    // ä¼æ¥­ãƒ‡ãƒ¼ã‚¿
    match /users/{userId}/companies/{companyId} {
      allow read, write: if request.auth != null 
                         && request.auth.uid == userId;
      
      // ä½œæˆæ™‚ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
      allow create: if request.auth.uid == userId
                    && request.resource.data.companyName is string
                    && request.resource.data.normalizedName is string
                    && request.resource.data.analysis is map;
    }
    
    // äºˆå®šãƒ‡ãƒ¼ã‚¿
    match /users/{userId}/events/{eventId} {
      allow read, write: if request.auth != null 
                         && request.auth.uid == userId;
      
      // ä½œæˆæ™‚ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
      allow create: if request.auth.uid == userId
                    && request.resource.data.companyId is string
                    && request.resource.data.date is timestamp
                    && request.resource.data.eventType is string;
    }
    
    // å‚¾å‘åˆ†æ
    match /users/{userId}/trends/{trendId} {
      allow read: if request.auth != null 
                  && request.auth.uid == userId;
      allow write: if false; // FunctionsçµŒç”±ã®ã¿
    }
    
    // ä½¿ç”¨é‡ãƒ‡ãƒ¼ã‚¿
    match /users/{userId}/usage/{usageId} {
      allow read: if request.auth != null 
                  && request.auth.uid == userId;
      allow write: if false; // FunctionsçµŒç”±ã®ã¿
    }
    
    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ‹’å¦
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
```

---

## 9. ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è¨ˆç”»

### 9.1 ã‚¹ã‚­ãƒ¼ãƒãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†

å„ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«`version`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ä¿æŒ:

```typescript
{
  version: "1.0",  // ç¾åœ¨ã®ã‚¹ã‚­ãƒ¼ãƒãƒãƒ¼ã‚¸ãƒ§ãƒ³
  // ... ãã®ä»–ã®ãƒ‡ãƒ¼ã‚¿
}
```

### 9.2 ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆä¾‹

```typescript
// v1.0 â†’ v1.1 ã¸ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
async function migrateToV1_1() {
  const companies = await db
    .collectionGroup('companies')
    .where('version', '==', '1.0')
    .get();

  const batch = db.batch();
  
  companies.forEach(doc => {
    batch.update(doc.ref, {
      version: '1.1',
      // æ–°ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ 
      'analysisMetadata.lastUpdateCheck': doc.data().analysisMetadata.analyzedAt
    });
  });

  await batch.commit();
}
```

---

## 10. ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã¨ãƒ¡ãƒˆãƒªã‚¯ã‚¹

### 10.1 ç›£è¦–å¯¾è±¡

| ãƒ¡ãƒˆãƒªã‚¯ã‚¹ | é–¾å€¤ | ã‚¢ãƒ©ãƒ¼ãƒˆ |
|----------|------|---------|
| èª­ã¿å–ã‚Šå›æ•° | > 50,000/æ—¥ | Email |
| æ›¸ãè¾¼ã¿å›æ•° | > 20,000/æ—¥ | Email |
| ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•° | > 100,000 | Email |
| ã‚¯ã‚¨ãƒªé…å»¶ | > 1ç§’ | Slack |

### 10.2 Firebase Consoleç¢ºèªé …ç›®

- Usage ã‚¿ãƒ–: èª­ã¿æ›¸ãå›æ•°
- Indexes ã‚¿ãƒ–: ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½œæˆçŠ¶æ³
- Rules ã‚¿ãƒ–: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«é©ç”¨çŠ¶æ³

---

## 11. ã¾ã¨ã‚

æœ¬ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆæ›¸ã¯ã€Job Mete v1.5ã®Firestoreãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«å…¨ä½“ã‚’ç¶²ç¾…ã—ã¦ã„ã¾ã™ã€‚

**é‡è¦ãªè¨­è¨ˆåˆ¤æ–­:**
1. **ä¼æ¥­ãƒ‡ãƒ¼ã‚¿ä¸­å¿ƒè¨­è¨ˆ:** äºˆå®šãŒä¼æ¥­ã‚’å‚ç…§ã™ã‚‹æ§‹é€ 
2. **éæ­£è¦åŒ–:** companyNameã‚’äºˆå®šã«ä¿æŒã—ã¦JOINä¸è¦åŒ–
3. **æ­£è¦åŒ–ã‚­ãƒ¼:** normalizedNameã§è¡¨è¨˜ã‚†ã‚Œã‚’å¸å
4. **ã‚µãƒ–ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³:** ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã®ãƒ‡ãƒ¼ã‚¿åˆ†é›¢
5. **ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³:** æ•´åˆæ€§ãŒå¿…è¦ãªç®‡æ‰€ã®ã¿ä½¿ç”¨

ã“ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆã¯ã€ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã‹ã‚‰æœ¬ç•ªç’°